"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}define(["fcs-base-ui","web-fc-solve","libfcs-wrap"],function(base_ui,w,Module){var FC_Solve=w.FC_Solve,_my_module=Module()({}),FCS_STATE_SUSPEND_PROCESS=w.FCS_STATE_SUSPEND_PROCESS,FCS_STATE_WAS_SOLVED=w.FCS_STATE_WAS_SOLVED;function _increment_move_indices(move_s){return move_s.replace(/(stack|freecell)( )(\d+)/g,function(match,resource_s,sep_s,digit_s){return resource_s+sep_s+(1+parseInt(digit_s))})}function toggle_advanced(){var ctl=$("#fcs_advanced");ctl.toggleClass("disabled");var my_text;my_text=ctl.hasClass("disabled")?"Advanced ▼":"Advanced ▲",$("#fcs_advanced_toggle").text(my_text)}function _create_bmark_obj(){return new base_ui.FC_Solve_Bookmarking({bookmark_controls:["stdin","preset","deal_number","one_based","unicode_suits","string_params","game_type"],show:[{id:"fcs_advanced",deps:["string_params"],callback:toggle_advanced}]})}function on_bookmarking(){return _create_bmark_obj().on_bookmarking()}w.FC_Solve_init_wrappers_with_module(_my_module);var fcs_ui=new(function(){function FC_Solve_UI(){_classCallCheck(this,FC_Solve_UI);this._instance=null,this._solve_err_code=null,this._was_iterations_count_exceeded=!1,this._is_expanded=!1,this._pristine_outputs=null}return _createClass(FC_Solve_UI,[{key:"_is_one_based_checked",value:function(){return $("#one_based").is(":checked")}},{key:"_is_unicode_suits_checked",value:function(){return $("#unicode_suits").is(":checked")}},{key:"_webui_output_set_text",value:function(text){$("#output").val(text)}},{key:"_one_based_process",value:function(text){return text.replace(/^Move[^\n]+$/gm,_increment_move_indices)}},{key:"_process_pristine_output",value:function(text){return this._is_one_based_checked()?this._one_based_process(text):text}},{key:"_update_output",value:function(){var that=this;if(that._webui_output_set_text(that._process_pristine_output(that._calc_pristine_output())),that._solve_err_code==FCS_STATE_WAS_SOLVED){var html="";html+="<ol>\n";var inst=that._instance,seq=inst._proto_states_and_moves_seq,_filt=function(str){return that._process_pristine_output(inst.unicode_preprocess(str))},_render_state=function(s){return'<li class="state"><pre>'+_filt(s.str)+"</pre></li>\n\n"},_out_state=function(i){html+=_render_state(seq[i])};_out_state(0);for(var i=1;i<seq.length-1;i+=2)html+='<li id="move_'+i+'" class="move unexpanded"><span class="mega_move">'+_filt(seq[i].m.str)+'</span>\n<button id="expand_move_'+i+'" class="expand_move">Expand Move</button>\n</li>\n',_out_state(i+1);$("#dynamic_output").html(html),$("#dynamic_output").on("click","button.expand_move",function(event){var button=$(this),b_id=button.attr("id"),idx=parseInt(b_id.match(/^expand_move_([0-9]+)$/)[1]),move_ctl=$("#move_"+idx);if(!move_ctl.hasClass("calced")){var inner_moves=inst._calc_expanded_move(idx),inner_html="";inner_html+='<ol class="inner_moves">';for(var _out_inner_move=function(i){inner_html+='<li class="move"><span class="inner_move">'+_filt(inner_moves[i].str)+"</span>\n</li>\n"},_i=0;_i<inner_moves.length-1;_i+=2)_out_inner_move(_i),inner_html+=_render_state(inner_moves[_i+1]);_out_inner_move(inner_moves.length-1),inner_html+="</ol>",move_ctl.append(inner_html),move_ctl.toggleClass("calced")}move_ctl.toggleClass("expanded"),move_ctl.toggleClass("unexpanded"),button.text(move_ctl.hasClass("expanded")?"Unexpand move":"Expand move")})}}},{key:"_re_enable_output",value:function(){$("#output").removeAttr("disabled")}},{key:"_webui_set_status_callback",value:function(myclass,mylabel){var ctl=$("#fc_solve_status");ctl.removeClass(),ctl.addClass(myclass),ctl.html(base_ui.escapeHtml(mylabel));var is_exceed="exceeded"==myclass;is_exceed&&(this._was_iterations_count_exceeded=!0),(is_exceed||"impossible"==myclass)&&this._re_enable_output()}},{key:"_calc_pristine_output",value:function(buffer){if(this._solve_err_code==FCS_STATE_WAS_SOLVED){var _expand=this._is_expanded,_k=_expand?1:0,_o=this._pristine_outputs;return _o[_k]=_o[_k]||this._instance.generic_display_sol({expand:_expand})}return""}},{key:"_webui_set_output",value:function(buffer){this._re_enable_output(),this._update_output()}},{key:"_enqueue_resume",value:function(){var that=this;setTimeout(function(){return that.do_resume()},50)}},{key:"_handle_err_code",value:function(){this._solve_err_code==FCS_STATE_WAS_SOLVED?this._webui_set_output():this._solve_err_code!=FCS_STATE_SUSPEND_PROCESS||this._was_iterations_count_exceeded||this._enqueue_resume()}},{key:"do_resume",value:function(){this._solve_err_code=this._instance.resume_solution(),this._handle_err_code()}},{key:"_get_string_params",value:function(){var text=$("#string_params").val();return"--game "+$("#game_type").val()+" "+(text.match(/\S/)?text:"")}},{key:"_get_cmd_line_preset",value:function(){return $("#preset").val()}},{key:"_calc_initial_board_string",value:function(){return $("#stdin").val().replace(/#[^\r\n]*\r?\n?/g,"")}},{key:"_disable_output_display",value:function(){$("#output").attr("disabled",!0)}},{key:"do_solve",value:function(){var that=this;that._pristine_outputs=[null,null],that._disable_output_display(),that._was_iterations_count_exceeded=!1,that._instance=new FC_Solve({cmd_line_preset:that._get_cmd_line_preset(),set_status_callback:function(myclass,mylabel){return that._webui_set_status_callback(myclass,mylabel)},is_unicode_cards:that._is_unicode_suits_checked(),dir_base:"fcs_ui",string_params:that._get_string_params()}),that._solve_err_code=that._instance.do_solve(that._calc_initial_board_string()),that._handle_err_code()}},{key:"toggle_expand",value:function(){var ret=this._is_expanded=!this._is_expanded;return this._webui_set_output(),ret}}]),FC_Solve_UI}());function fc_solve_do_solve(){return fcs_ui.do_solve()}function on_toggle_one_based(){$("#output").val()&&fcs_ui._update_output()}function clear_output(){return fcs_ui._webui_output_set_text("")}function set_up_handlers(){$("#populate_input").click(base_ui.populate_input_with_numbered_deal),$("#run_do_solve").click(fc_solve_do_solve)}return{set_up:function(){_create_bmark_obj().restore_bookmark(),set_up_handlers(),$("#fcs_advanced_toggle").click(toggle_advanced),$("#one_based").click(on_toggle_one_based),$("#clear_output").click(clear_output),$("#fc_solve_bookmark_button").click(on_bookmarking)},set_up_handlers:set_up_handlers}});